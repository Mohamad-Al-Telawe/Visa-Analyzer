index.html
<!DOCTYPE html>
<html lang="ar" dir="rtl">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>ุชูุงุฑูุฑ ููุงุท ุงูุจูุน</title>
      <link rel="stylesheet" href="style.css" />
   </head>
   <body>
      <h1>๐ ุฅุฌูุงููุงุช ููุงุท ุงูุจูุน</h1>

      <h3>ุฃุฏุฎู ูุญุชูู ููู ุงูููุฒุง:</h3>
<textarea id="visa-text" rows="10" cols="80" placeholder="ุงูุณุฎ ููุง ูุญุชูู ุงูุชูุฑูุฑ"></textarea>
<br>
<button id="analyze-btn">ุชุญููู ุงูุชูุฑูุฑ</button>

<h3>ุฅุฌูุงููุงุช ุงููุญุทุงุช:</h3>
<table border="1">
    <thead>
        <tr>
            <th>Terminal ID</th>
            <th>Gross Total</th>
            <th>Net Total</th>
            <th>ุนุฏุฏ ุงููุนุงููุงุช</th>
        </tr>
    </thead>
    <tbody id="totals-body"></tbody>
</table>

      <hr style="margin: 40px 0" />

      <h2>๐ ููุงุฑูุฉ ุงูููุงุชูุฑ</h2>

      <section id="compare-section">
         <div class="compare-controls">
            <label>ุงุฎุชุฑ Terminal ID:</label>
            <select id="terminal-select"></select>
         </div>

         <textarea
            id="invoice-input"
            placeholder="ุฃูุตู ููุง ูุต ุงูููุงุชูุฑ..."
            rows="10"></textarea>

         <div class="options">
            <label
               ><input type="checkbox" id="showExact" checked /> ุนุฑุถ ุงููุทุงุจูุงุช
               ุงูุชุงูุฉ (ุฑูู ุงูุจุทุงูุฉ + ุงููููุฉ)</label
            ><br />
            <label
               ><input type="checkbox" id="showCardOnly" checked /> ุนุฑุถ ุงุฎุชูุงู
               ุงููููุฉ ููุท ูุน ููุณ ุฑูู ุงูุจุทุงูุฉ</label
            ><br />
            <label
               ><input type="checkbox" id="showAmountOnly" checked /> ุนุฑุถ ุงุฎุชูุงู
               ุฑูู ุงูุจุทุงูุฉ ุจููุณ ุงููููุฉ</label
            ><br />
            <label
               ><input type="checkbox" id="showInvoiceOnly" checked /> ุนุฑุถ
               ููุงุชูุฑ ูุง ุชุทุงุจู ุฃู ุณุฌู</label
            ><br />
            <label
               ><input type="checkbox" id="showRecordOnly" checked /> ุนุฑุถ ุณุฌูุงุช
               ูุง ุชุทุงุจู ุฃู ูุงุชูุฑุฉ</label
            >
         </div>

         <button id="compare-btn">ูุงุฑู ุงูุขู</button>

         <div id="compare-results"></div>
      </section>

      <script src="script.js"></script>
   </body>
</html>




script.js

let merged = []; // ุฅุนูุงู ูุชุบูุฑ ุนุงู
let text = ``;
document.getElementById("analyze-btn").addEventListener("click", () => {
     text = document.getElementById("visa-text").value;

    if (!text.trim()) {
        alert("ุงูุฑุฌุงุก ุฅุฏุฎุงู ูุญุชูู ุงูุชูุฑูุฑ");
        return;
    }

    const raw = parseMerchantReport(text);
    merged = mergeTerminals(raw); // <-- ุชุญุฏูุซ ุงููุชุบูุฑ ุงูุนุงู
    renderTotalsTable(merged);

    // ุชูุธูู ุงููุงุฆูุฉ ุงููุฏููุฉ ูุฅุนุงุฏุฉ ุชุนุจุฆุชูุง
    const select = document.getElementById("terminal-select");
    select.innerHTML = "";
    populateTerminalSelect(merged);
});



// ุงูุฏุงูุชุงู ูู ูุจู ๐
function parseMerchantReport(text) {
   const terminals = [];
   const terminalBlocks = text.split(/Terminal ID:/).slice(1);

   terminalBlocks.forEach((block) => {
      const lines = block
         .trim()
         .split("\n")
         .map((l) => l.trim())
         .filter(Boolean);

      const terminalId = lines[0].trim();
      const transactions = [];
      let totalGross = null,
         totalNet = null;

      for (let i = 0; i < lines.length; i++) {
         const line = lines[i];

         // ๐น ุงุณุชุฎุฑุงุฌ ุฑูู ุงูุจุทุงูุฉ ูุงููุจูุบ ุงูุตุงูู (Net)
         const cardMatch = line.match(/\*{6}(\d{4})/);
         const netMatch = line.match(/\s\d+\.\d+-\d+\.\d+\s+(\d+\.\d+)/);

         if (cardMatch && netMatch) {
            transactions.push({
               cardNumber: cardMatch[1],
               amount: parseFloat(netMatch[1]),
            });
         }

         // ๐น ุงูุจุญุซ ุนู ุณุทุฑ Total
         if (/^Total/i.test(line)) {
            let gross = null;
            let net = null;
            let collectedNumbers = [];

            // ุงุฌูุน ุงูุฃุณุทุฑ ุงูุชุงููุฉ (ุญุชู 5 ุฃุณุทุฑ ุจุนุฏ Total)
            for (let k = i; k < i + 6 && k < lines.length; k++) {
               const nums = lines[k].match(/[\d]+\.\d+/g);
               if (nums) collectedNumbers.push(...nums);

               // ุฅุฐุง ุธูุฑุช ูููุฉ Net ูุญุงูู ุงูุชูุงุท ุงูุฑูู ุจุนุฏูุง ูุจุงุดุฑุฉ
               const netLine = lines[k].match(/Net\s*([\d.]+)/i);
               if (netLine) {
                  net = parseFloat(netLine[1]);
               }
            }

            // โ๏ธ ุชุญุฏูุฏ Gross ูNet ูู ุงูุฃุฑูุงู ุงููุฌูุนุฉ
            if (collectedNumbers.length >= 2) {
               // Gross ูู ุฃูู ุฑูู ุจุนุฏ ูููุฉ Total
               gross = parseFloat(collectedNumbers[0]);

               // Net ุนุงุฏุฉ ุขุฎุฑ ุฑูู ูู ุงููุชูุฉ
               net = net ?? parseFloat(collectedNumbers[collectedNumbers.length - 1]);
            }

            // โ ุชุญุฏูุซ ุงูุฅุฌูุงููุงุช ุฅู ูุงูุช ูุนูููุฉ
            if (gross && net && net <= gross * 1.1 && net >= gross * 0.5) {
               totalGross = gross;
               totalNet = net;
            }
         }
      }

      terminals.push({
         terminalId,
         total: { gross: totalGross, net: totalNet },
         transactions,
      });
   });

   return terminals;
}



// function mergeTerminals(terminals) {
//    const merged = {};

//    terminals.forEach((item) => {
//       const id = item.terminalId;
//       if (!merged[id]) {
//          merged[id] = {
//             terminalId: id,
//             transactions: [],
//             total: { gross: 0, net: 0 },
//          };
//       }
//       merged[id].transactions.push(...item.transactions);
//       if (item.total?.gross) merged[id].total.gross = item.total.gross;
//       if (item.total?.net) merged[id].total.net = item.total.net;
//    });

//    return Object.values(merged);
// }

function mergeTerminals(terminals) {
   const merged = {};

   terminals.forEach((item) => {
      const id = item.terminalId;
      if (!merged[id]) {
         merged[id] = {
            terminalId: id,
            transactions: [],
            total: { gross: 0, net: 0 },
         };
      }

      merged[id].transactions.push(...item.transactions);

      // ุฅุฐุง ูุฌุฏูุง ุฅุฌูุงูู ุฑุณูู ูู ุงูุชูุฑูุฑ ูุณุชุฎุฏูู
      if (item.total?.gross) merged[id].total.gross = item.total.gross;
      if (item.total?.net) merged[id].total.net = item.total.net;
   });

   // ุจุนุฏ ุงูุฏูุฌ: ุฅุฐุง ุจูู ุงูุฅุฌูุงูู ุตูุฑุ ูุญุณุจู ูู ุงููุนุงููุงุช
   Object.values(merged).forEach((item) => {
      if (!item.total.gross && item.transactions.length) {
         item.total.gross = item.transactions.reduce(
            (sum, t) => sum + t.amount,
            0
         );
         item.total.net = item.total.gross; // ุฅุฐุง ูู ููู ููุงู ูุฑู ุจูู gross ูnet ูู ุงููุนุงููุงุช
      }
   });

   return Object.values(merged);
}

// โ๏ธ ุชุดุบูู ุงูุชุญููู ูุงูุนุฑุถ
const raw = parseMerchantReport(text);
 merged = mergeTerminals(raw);
renderTotalsTable(merged);

function renderTotalsTable(data) {
   const tbody = document.getElementById("totals-body");
   tbody.innerHTML = "";

   data.forEach((item) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
      <td>${item.terminalId}</td>
      <td>${item.total.gross?.toFixed(3) || "-"}</td>
      <td>${item.total.net?.toFixed(3) || "-"}</td>
      <td>${item.transactions.length}</td>
   `;
      tbody.appendChild(tr);
   });
}

// ------------------ ุชุญููู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ------------------
function populateTerminalSelect(data) {
   const select = document.getElementById("terminal-select");
   data.forEach((item) => {
      const opt = document.createElement("option");
      opt.value = item.terminalId;
      opt.textContent = item.terminalId;
      select.appendChild(opt);
   });
}

// ุจุนุฏ ุชุญููู ุงูุตูุญุฉ
populateTerminalSelect(merged);

// ------------------ ุฏุงูุฉ ุงุณุชุฎุฑุงุฌ ุงูููุงุชูุฑ ------------------
function parseInvoices(text) {
   const lines = text
      .split("\n")
      .map((l) => l.trim())
      .filter(Boolean);
   const invoices = [];

   lines.forEach((line) => {
      // ุงูููุทูู ุงููููููู
      let match = line.match(
         /^([\d.]+)\s*(?:Card Number|ุฑูู ุงูุจุทุงูุฉ)\s*[:๏ผ]?\s*(\d{4})/
      );
      if (match) {
         invoices.push({
            amount: parseFloat(match[1]),
            cardNumber: match[2],
         });
      }
   });

   return invoices;
}

// ------------------ ุฏุงูุฉ ุงูููุงุฑูุฉ ------------------
function compareInvoicesToRecords(invoices, records, options) {
   const results = [];
   const usedInvoices = new Set();
   const usedRecords = new Set();

   // 1๏ธโฃ ุงููุทุงุจูุงุช ุงูุชุงูุฉ
   if (options.showExact) {
      invoices.forEach((inv, i) => {
         const matchIdx = records.findIndex(
            (r, j) =>
               !usedRecords.has(j) &&
               r.cardNumber === inv.cardNumber &&
               Math.abs(r.amount - inv.amount) < 0.001
         );
         if (matchIdx !== -1) {
            results.push({
               type: "ูุทุงุจูุฉ ุชุงูุฉ โ",
               card: inv.cardNumber,
               amount: inv.amount,
            });
            usedInvoices.add(i);
            usedRecords.add(matchIdx);
         }
      });
   }

   // 2๏ธโฃ ููุณ ุฑูู ุงูุจุทุงูุฉ ููู ููู ูุฎุชููุฉ
   if (options.showCardOnly) {
      invoices.forEach((inv, i) => {
         if (usedInvoices.has(i)) return;
         const matchIdx = records.findIndex(
            (r, j) => !usedRecords.has(j) && r.cardNumber === inv.cardNumber
         );
         if (matchIdx !== -1) {
            results.push({
               type: "ุงุฎุชูุงู ูู ุงููููุฉ โ๏ธ",
               card: inv.cardNumber,
               invoiceAmount: inv.amount,
               recordAmount: records[matchIdx].amount,
            });
            usedInvoices.add(i);
            usedRecords.add(matchIdx);
         }
      });
   }

   // 3๏ธโฃ ููุณ ุงููููุฉ ููู ุฑูู ุงูุจุทุงูุฉ ูุฎุชูู
   if (options.showAmountOnly) {
      invoices.forEach((inv, i) => {
         if (usedInvoices.has(i)) return;
         const matchIdx = records.findIndex(
            (r, j) =>
               !usedRecords.has(j) && Math.abs(r.amount - inv.amount) < 0.001
         );
         if (matchIdx !== -1) {
            results.push({
               type: "ุงุฎุชูุงู ูู ุฑูู ุงูุจุทุงูุฉ โ๏ธ",
               amount: inv.amount,
               invoiceCard: inv.cardNumber,
               recordCard: records[matchIdx].cardNumber,
            });
            usedInvoices.add(i);
            usedRecords.add(matchIdx);
         }
      });
   }

   // 4๏ธโฃ ูุงุชูุฑุฉ ุจุฏูู ุฃู ุชุทุงุจู
   if (options.showInvoiceOnly) {
      invoices.forEach((inv, i) => {
         if (usedInvoices.has(i)) return;
         results.push({
            type: "ูุงุชูุฑุฉ ุบูุฑ ููุฌูุฏุฉ โ",
            card: inv.cardNumber,
            amount: inv.amount,
         });
      });
   }

   // 5๏ธโฃ ุณุฌู ุจุฏูู ุฃู ูุงุชูุฑุฉ
   if (options.showRecordOnly) {
      records.forEach((r, j) => {
         if (usedRecords.has(j)) return;
         results.push({
            type: "ุณุฌู ุบูุฑ ูุทุงุจู โ๏ธ",
            card: r.cardNumber,
            amount: r.amount,
         });
      });
   }

   return results;
}

// ------------------ ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ ุงูููุงุฑูุฉ ------------------
document.getElementById("compare-btn").addEventListener("click", () => {
   const selectedId = document.getElementById("terminal-select").value;
   const invoiceText = document.getElementById("invoice-input").value;
   const invoices = parseInvoices(invoiceText);

   const terminal = merged.find((t) => t.terminalId === selectedId);
   if (!terminal) {
      alert("ุงูุฑุฌุงุก ุงุฎุชูุงุฑ Terminal ID ุตุญูุญ");
      return;
   }

   const options = {
      showExact: document.getElementById("showExact").checked,
      showCardOnly: document.getElementById("showCardOnly").checked,
      showAmountOnly: document.getElementById("showAmountOnly").checked,
      showInvoiceOnly: document.getElementById("showInvoiceOnly").checked,
      showRecordOnly: document.getElementById("showRecordOnly").checked,
   };

   const result = compareInvoicesToRecords(
      invoices,
      terminal.transactions,
      options
   );

   const container = document.getElementById("compare-results");
   container.innerHTML =
      "<h3>ูุชุงุฆุฌ ุงูููุงุฑูุฉ:</h3>" +
      result.map((r) => JSON.stringify(r)).join("<br>");
});



information.json
{
  "ูุฑูุฉ1": [
    {
      "Terminal ID": "20035149",
      "name": "ุณูุชู ุณูุชุฑ ุงููุฑู",
      "account id": 133223,
      "bank account": "ุจูู ุงูุฃููู / ูุฌููุนุฉ ุงูุงููุจู"
    },
    {
      "Terminal ID": "01340256",
      "name": "ูุฒูู",
      "account id": 133212,
      "bank account": "ุจูู ุงูุฃููู / ูุฌููุนุฉ ุงูุงููุจู"
    },
    {
      "Terminal ID": "01340264",
      "name": "ุงูุชููู 2",
      "account id": 133202,
      "bank account": "ุจูู ุงูุฃููู / ูุฌููุนุฉ ุงูุงููุจู"
    },
    {
      "Terminal ID": "01340272",
      "name": "ุงูุณุนุงุฏุฉ",
      "account id": 133211,
      "bank account": "ุจูู ุงูุฃููู / ูุฌููุนุฉ ุงูุงููุจู"
    },
    {
      "Terminal ID": "01340280",
      "name": "ุงูุณูุจ 2",
      "account id": 133204,
      "bank account": "ุจูู ุงูุฃููู / ูุฌููุนุฉ ุงูุงููุจู"
    },
    {
      "Terminal ID": "01340298",
      "name": "ุตุญุงุฑ 2",
      "account id": 133206,
      "bank account": "ุจูู ุงูุฃููู / ูุฌููุนุฉ ุงูุงููุจู"
    },
    {
      "Terminal ID": "01399377",
      "name": "ุงูุฎูุถ",
      "account id": 133213,
      "bank account": "ุจูู ุงูุฃููู / ูุฌููุนุฉ ุงูุงููุจู"
    },
    {
      "Terminal ID": "01450618",
      "name": "ุงูุญูู 2",
      "account id": 133215,
      "bank account": "ุจูู ุงูุฃููู / ูุฌููุนุฉ ุงูุงููุจู"
    },
    {
      "Terminal ID": "20045522",
      "name": "ุงูููู ููู",
      "account id": 133218,
      "bank account": "ุจูู ุงูุฃููู / ููุณุงุช ุงูุนุงูููุฉ ููุงุณุชุซูุงุฑ"
    },
    {
      "Terminal ID": "20082624",
      "name": "ุณูุชู ุณูุชุฑ ุตุญุงุฑ",
      "account id": 133221,
      "bank account": "ุจูู ุงูุฃููู / ููุณุงุช ุงูุนุงูููุฉ ููุงุณุชุซูุงุฑ"
    },
    {
      "Terminal ID": "20082632",
      "name": "ุนูุงู ููู",
      "account id": 133222,
      "bank account": "ุจูู ุงูุฃููู / ููุณุงุช ุงูุนุงูููุฉ ููุงุณุชุซูุงุฑ"
    },
    {
      "Terminal ID": "01336858",
      "name": "ุงูุญูู 1",
      "account id": 133207,
      "bank account": "ุจูู ุงูุฃููู / ููุณุงุช ุงูุนุงูููุฉ ููุงุณุชุซูุงุฑ"
    },
    {
      "Terminal ID": "01336866",
      "name": "ุตุญุงุฑ 1",
      "account id": 133205,
      "bank account": "ุจูู ุงูุฃููู / ููุณุงุช ุงูุนุงูููุฉ ููุงุณุชุซูุงุฑ"
    },
    {
      "Terminal ID": "01336874",
      "name": "ุงูุชููู 1",
      "account id": 133201,
      "bank account": "ุจูู ุงูุฃููู / ููุณุงุช ุงูุนุงูููุฉ ููุงุณุชุซูุงุฑ"
    },
    {
      "Terminal ID": "01336882",
      "name": "ุดุงุฑุน ุงูุณูุงู",
      "account id": 133210,
      "bank account": "ุจูู ุงูุฃููู / ููุณุงุช ุงูุนุงูููุฉ ููุงุณุชุซูุงุฑ"
    },
    {
      "Terminal ID": "20336890",
      "name": "ููููุญ",
      "account id": 133224,
      "bank account": "ุจูู ุงูุฃููู / ููุณุงุช ุงูุนุงูููุฉ ููุงุณุชุซูุงุฑ"
    },
    {
      "Terminal ID": "01663954",
      "name": "ูุณูุท ููู",
      "account id": 133216,
      "bank account": "ุจูู ุงูุฃููู / ููุณุงุช ุงูุนุงูููุฉ ููุงุณุชุซูุงุฑ"
    },
    {
      "Terminal ID": "20080727",
      "name": "ุงูุณูุจ3",
      "account id": 133217,
      "bank account": "ุจูู ุงูุฃููู / ุงููู ุงูุดุงูู"
    },
    {
      "Terminal ID": "20080735",
      "name": "ุงูุนุงูุฑุงุช",
      "account id": 133219,
      "bank account": "ุจูู ุงูุฃููู / ุงููู ุงูุดุงูู"
    },
    {
      "Terminal ID": "20080743",
      "name": "ุงูุชููู 3",
      "account id": 133220,
      "bank account": "ุจูู ุงูุฃููู / ุงููู ุงูุดุงูู"
    },
    {
      "Terminal ID": "20080750",
      "name": "ุตูุฑ",
      "account id": 133209,
      "bank account": "ุจูู ุงูุฃููู / ุงููู ุงูุดุงูู"
    }
  ]
}


13216-ุจูู ุงูุงููู /ููุณุงุช ุงูุนุงูููุฉ ููุงุณุชุซูุงุฑ
13217-ุจูู ุงูุงููู /ูุฌููุนุฉ ุงูุงููุจู
13219-ุจูู ุงูุฃููู / ุงููู ุงูุดุงูู

52121-ูุตุงุฑูู ุนูููุฉ ููุฒุงยูุงุฑุฏย(ุนูุงู)